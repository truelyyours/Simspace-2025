# GRASSMARLIN and Elastic - Lab Preparation

# Objective
Use the network traffic and list of known devices provided to identify potential malicious activity within the ICS network.
## Scenario

A customer has provided the team with network captures that *cover three (3) days of operation*. The customer suspects that a breach has occurred and needs our assistance identifying the potential malicious activity.

Use **GRASSMARLIN and Security Onion's Elastic instance** to identify assets and traffic, detect anomalies, and find any existing malicious activity.

GRASSMARLIN is a tool created by the National Security Agency (NSA). GRASSMARLIN Provides *IP network situational awareness of ICS and supervisory control and data acquisition (SCADA)* networks to support network security.
## Known Hosts

![[cafb36ea-cfa7-4775-89a8-2b701985e3ed.png]]

# Elastic 
As mentioned earlier in the module, Security Onion is a popular open-source NSM solution that includes the Elastic Stack (formerly ELK Stack) among other tools. Elastic can be used as a basic SIEM to ingest data and log files from various solutions for automated and/or manual analysis.

Kibana is the frontend to Elastic. It is a single-pane-of-glass view for all data and reports collected or generated by Security Onion. The former ELK Stack was comprised of three base components, which are still used in the newer versions:
![[f1180c6c-f6a2-4cc8-ae06-cdf4c460aa5a.png]]
The records contain a large amount of data, but may be difficult to view or fully interpret in the default view. _Discover_ selects specific fields to display from a list. The Elasticsearch database is considered a Time Series database, which is different from relational databases.
## Time Series versus Relational Databases

In a relational database, every record in a table has the same fields. In Elasticsearch, everything is dumped into the same database and tagged with an index to organize data into subsets. The default Security Onion index is Logstash, and everything ingested via Logstash is given this tag. That means that all Snort/Suricata logs and Bro/Zeek logs are in the same index, yet the log entries for each solution have different fields.

## Security Onion

![[c80b871e-a5f5-4b18-b9c2-06fd806be5b8.png]]

Security Onion's pre-configured dashboards include a Navigation pane linking additional dashboards that focus on data subsets such as the type of log, specific traffic types, and particular application protocols.
The Navigation pane's Alert Data section focuses on specific alerts from the various detection tools incorporated into Security Onion. For example, an administrator logging into a system via `ssh` may not generate an alert, but the connection would be recorded in a Zeek connection log. If an attacker tries a brute force attack, the attempt results in multiple failed login entries logged as NIDS alerts (possibly Zeek alerts) and host-based alerts from OSSEC and Wazuh. The session information is also saved in the connection log.

The Alerts > Zeek Hunting section provides breakouts of many well-known protocols. The Host Hunting section focuses on host-based data. Other sections have additional data representations.

The 2015-10-20 traffic includes much DNS-related information. The **Zeek-DNS** dashboard provides more details about that data.

1. Select **DNS** in the **Zeek Hunting** section to drill in on the DNS logs.

The window refreshes to show the **Zeek-DNS** dashboard.

Notice the information about the total DNS logs, the visual representation of DNS activity to time, and a breakout of the DNS query types and response codes. On the visual timeline, the activity is consistent across the time slice except a small bump just after 18:00.

Note all of the `REFUSED` response codes, which could indicate a technical issue where requests are not reaching the DNS server. The **Zeek-DNS** dashboard includes additional statistics such as the top DNS clients and the top DNS servers. A workstation sending out more requests than another with similar purpose and build requires deeper investigation.

The dashboard includes an ordered display of DNS queries by name and count. This is the same dataset used for the vertical bar graph in an earlier exercise.
![[467a4716-a964-4da9-be53-beeb934b37be.png]]
