Enter the IP address of the internal host infected with Gh0st RAT malware.

## Background

The only actionable information provided in the scenario that can aid in starting the investigation is that there is a suspected Gh0st RAT malware infection.

Intrusion detection signatures for Gh0st RAT are widely available and enabled by default in most rule sets. Suricata IDS logs were provided as a source. Therefore, analyzing these logs is a logical place to begin the investigation. The network diagram shows the location of two sensors named `onion-fn1` and `onion-fn2`, which generate the Zeek and Suricata logs. These logs have been ingested in Splunk.

To start querying events in Splunk, it is useful to understand how the log sources were ingested, and which indexes they are stored in. Run the following commands to get a list of available indexes, and then get a mapping of sourcetypes to the indexes.

```
index=* | stats count by index
```

```
index=* | stats count by sourcetype index
```


# Determining the Infected Hosts

Survey Splunk indexes/sourcetypes:
```
index=* | stats count by index sourcetype
```

The survey of ingested data shows that Suricata logs are stored in the index named `suricata`.

The hosts field shows that there are two hosts that generated Suricata logs, `onion-fn1` and `onion-fn2`. The network diagram shows that `onion-fn1` monitors the **network perimeter**. Logs generated by `onion-fn1` are therefore most likely to help provide the IP address of the internal host.

The following Splunk query shows all Suricata logs generated by `onion-fn1`:
```
index=suricata host=onion-fn1
```

A technique called **stack counting, or long tail analysis**, can be used to further reduce the log count by focusing on a single interesting field. In this case the field called `alert.signature` appears to provide a short description of what triggered the IDS alert. This field is a good candidate for stack counting.

The following Splunk query shows only the `alert.signature` fields generated by `onion-fn1`:
```
index=suricata host=onion-fn1| stats count by alert.signature
```

The filtered logs can be searched for evidence of Gh0st RAT.
The query reveals three event signatures associated with Gh0st RAT:
- ET TROJAN Backdoor family PCRat/Gh0st CnC traffic
- ET TROJAN Backdoor family PCRat/Gh0st CnC traffic (OUTBOUND) 102
- ET TROJAN Gh0st Remote Access Trojan Encrypted Session To CnC Server

All of these alerts contain the string `Gh0st` (spelled with a zero). A string search for the phrase “Gh0st” can be added to the first part of the query. Fields for source and destination IP can be added to the final query output. The following Splunk query searches for alerts containing the string `Gh0st`, and extracts fields such as the **timestamp, alert signature, source IP and destination IP**:

```
index=suricata host=onion-fn1 Gh0st | stats count by _time alert.signature src_ip dest_ip
```

This reveals that the potentially infected host IP

ET TROJAN Backdoor family PCRat/Gh0st CnC traffic	2023-06-22 10:14:57	172.16.6.104	119.28.139.120	1
ET TROJAN Backdoor family PCRat/Gh0st CnC traffic	2023-06-22 10:59:11	172.16.6.104	119.28.139.120	1
ET TROJAN Backdoor family PCRat/Gh0st CnC traffic	2023-06-22 11:34:53	172.16.6.104	119.28.139.120	1

`172.16.6.104` and dest_ip =  `119.28.139.120`

NEXT: [[Question 2]]
